<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Monitor de Temperaturas</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
  background: #f2f2f2;
  font-family: Arial, sans-serif;
  padding: 20px;
}
.card {
  background: white;
  padding: 15px;
  margin-bottom: 12px;
  border-radius: 12px;
  box-shadow: 0 0 10px #ccc;
  display: flex;
  align-items: center;
}
.temp {
  font-size: 32px;
  font-weight: bold;
  margin-left: 10px;
}
.icon {
  font-size: 40px;
}
.alerta-baja { color: blue; }
.alerta-media { color: green; }
.alerta-normal { color: black; }
.alerta-alta { color: red; }
</style>
</head>

<body>

<h1>ğŸ”¥ Monitor de Temperaturas ESP32</h1>

<div class="card">
  <span class="icon">ğŸŒ¡ï¸</span>
  <span class="temp" id="patioTemp">--</span> Â°C â€” Patio
</div>

<div class="card">
  <span class="icon">ğŸŒ¡ï¸</span>
  <span class="temp" id="garajeTemp">--</span> Â°C â€” Garaje
</div>

<div class="card">
  <span class="icon">ğŸŒ¡ï¸</span>
  <span class="temp" id="cuarto3Temp">--</span> Â°C â€” Cuarto 3
</div>

<div class="card">
  <span class="icon">ğŸŒ¡ï¸</span>
  <span class="temp" id="cuarto4Temp">--</span> Â°C â€” Cuarto 4
</div>

<div class="card">
  <h3>Promedio:</h3>
  <span class="temp" id="promTemp">--</span> Â°C
</div>

<canvas id="tempChart" style="width:100%; max-height:350px;"></canvas>

<script>
// GRÃFICO ESTABLE (MÃX 30 MUESTRAS)
var ctx = document.getElementById('tempChart').getContext('2d');
var tempChart = new Chart(ctx, {
    type: 'line',
    data: {
        labels: [],
        datasets: [{
            label: 'Promedio',
            data: [],
            borderWidth: 2
        }]
    }
});

// Actualizar datos cada 2 segundos
setInterval(() => {
    fetch("/temps")
    .then(res => res.json())
    .then(data => {

        document.getElementById("patioTemp").textContent = data.patio;
        document.getElementById("garajeTemp").textContent = data.garaje;
        document.getElementById("cuarto3Temp").textContent = data.cuarto3;
        document.getElementById("cuarto4Temp").textContent = data.cuarto4;
        document.getElementById("promTemp").textContent = data.promedio;

        // --- ALERTAS ---
        function setColor(id, t) {
            let e = document.getElementById(id);
            e.className = "temp";

            if (t < 10) e.classList.add("alerta-baja");
            else if (t < 15) e.classList.add("alerta-media");
            else if (t <= 38) e.classList.add("alerta-normal");
            else e.classList.add("alerta-alta");
        }

        setColor("patioTemp", data.patio);
        setColor("garajeTemp", data.garaje);
        setColor("cuarto3Temp", data.cuarto3);
        setColor("cuarto4Temp", data.cuarto4);
        setColor("promTemp", data.promedio);

        // --- GRAFICO ESTABLE ---
        const MAX_POINTS = 30;

        tempChart.data.labels.push('');
        tempChart.data.datasets[0].data.push(data.promedio);

        if (tempChart.data.labels.length > MAX_POINTS) {
            tempChart.data.labels.shift();
            tempChart.data.datasets[0].data.shift();
        }

        tempChart.update();
    });
}, 2000);
</script>

</body>
</html>
